<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Demo: ClayMultiSelect</title>

	<link rel="stylesheet" href="../../../node_modules/clay-css/lib/css/atlas.css">

	<style>
		body {
			background-color: #FFF;
		}

		.row {
			margin-bottom: 20px;
		}

		.label-focus {
			background-color: #0B5FFF;
			border-color: #0B5FFF;
			color: #FFF;
		}

		.dropdown-full {
			position: relative;
		}
	</style>

	<script src="../build/globals/clay-multi-select.js"></script>
</head>
<body class="container" role="main">
	<h1 class="page-title" id="pageTitle">
		ClayMultiSelect
	</h1>

	<div class="row row-spacing">
		<div class="col">
			<h2>Default State</h2>
			<div id="default-block"></div>
		</div>
	</div>

	<div class="row row-spacing">
		<div class="col">
			<h2>With autocomplete</h2>
			<div id="autocomplete-block"></div>
		</div>
	</div>

	<div class="row row-spacing">
		<div class="col">
			<h2>With autocomplete and interaction</h2>
			<div id="interaction-block"></div>
		</div>
	</div>

	<div class="row row-spacing">
		<div class="col">
			<h2>With only items selected</h2>
			<div id="selected-block"></div>
		</div>
	</div>

	<script type="text/javascript">

		const spritemap = '../../../node_modules/clay-css/lib/images/icons/icons.svg';
		const selectedItems = [
			{
				label: 'bread',
				value: 'bread',
			},
			{
				label: 'ammonia cookie',
				value: 'ammonia cookie',
			}
		];
		const dataProvider = [
			'Bread',
			'Ammonia cookie',
			'Cuisine of Antebellum America',
			'Apple butter',
			'Apple sauce',
			'Baked potato',
			'Barbecue',
			'Bear claw',
			'Beef Manhattan',
			'Blue cheese dressing',
			'Blue-plate special',
			'Bookbinder soup',
			'Breakfast burrito',
			'Brunswick stew',
			'Buffalo burger',
			'Buffalo wing',
			'Bull roast',
			'Burnt ends',
			'Butter cookie',
		];

		// Default State
		new metal.ClayMultiSelect({
			helpText: 'You can use a comma to enter tags',
			label: 'Tags',
			selectedItems,
			spritemap,
		}, '#default-block');

		// With autocomplete
		new metal.ClayMultiSelect({
			events: {
				queryChange: autocomplete,
			},
			helpText: 'You can use a comma to enter tags',
			label: 'Tags',
			selectedItems,
			spritemap,
		}, '#autocomplete-block');

		// With autocomplete and interaction
		new metal.ClayMultiSelect({
			label: 'Tags',
			selectedItems,
			spritemap,
			events: {
				itemAdded: (event) => {
					event.target.selectedItems.push({label: event.data.label, value: event.data.label});
					addToSelectedItems(event);
				},
				itemRemoved: removeItem,
				itemSelected: (event) => {
					const label = event.data.originalString.toLowerCase();
					event.target.selectedItems.push({label, value: label});
					addToSelectedItems(event);
				},
				queryChange: autocomplete,
			},
			helpText: 'You can use a comma to enter tags',
		}, '#interaction-block');

		// With only items selected
		new metal.ClayMultiSelect({
			label: 'Tags',
			selectedItems,
			spritemap,
			events: {
				itemRemoved: removeItem,
				itemSelected: (event) => {
					const label = event.data.originalString.toLowerCase();
					event.target.selectedItems.push({label, value: label});
					addToSelectedItems(event);
				},
				queryChange: autocomplete,
			},
			helpText: 'You can use a comma to enter tags',
		}, '#selected-block');

		function addToSelectedItems(event) {
			event.target.selectedItems = event.target.selectedItems;
			event.target.clearInput();
			event.target.filteredItems = [];
		}

		function removeItem(event) {
			event.target.selectedItems.splice(Number(event.data.index), 1);
			event.target.selectedItems = event.target.selectedItems;
		}

		function autocomplete(event) {
			const query = event.data.value;

			if (query) {
				const filterAutocomplete = event.target.filterAutocomplete;
				event.target.filteredItems = filterAutocomplete(dataProvider, query);
			} else {
				event.target.filteredItems = [];
			}
		}

	</script>
</body>
</html>
